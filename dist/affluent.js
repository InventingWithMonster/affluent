!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).affluent={})}(this,function(t){"use strict";var n,e,r,u=function(){return(u=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var u in n=arguments[e])Object.prototype.hasOwnProperty.call(n,u)&&(t[u]=n[u]);return t}).apply(this,arguments)},o=function(n,e){return function(t){return Math.max(Math.min(t,e),n)}},a=function(n){return function(t){return"string"==typeof t&&0===t.indexOf(n)}},c=function(t){return t%1?Number(t.toFixed(5)):t},i={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},f=(u({},i,{transform:o(0,1)}),u({},i,{default:1}),n="%",{test:function(t){return"string"==typeof t&&t.endsWith(n)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+n}}),s=o(0,255),p=function(a){var i=a.length;return function(t){if("string"!=typeof t)return t;for(var n,e,r={},u="string"==typeof(n=(e=t).substring(e.indexOf("(")+1,e.lastIndexOf(")")))?n.split(/,\s*/):[n],o=0;o<i;o++)r[a[o]]=void 0!==u[o]?parseFloat(u[o]):1;return r}},d=u({},i,{transform:function(t){return Math.round(s(t))}}),l=a("rgb"),h={test:function(t){return"string"==typeof t?l(t):void 0!==t.red},parse:p(["red","green","blue","alpha"]),transform:function(t){var n,e,r,u,o,a=t.red,i=t.green,f=t.blue,s=t.alpha;return n={red:d.transform(a),green:d.transform(i),blue:d.transform(f),alpha:c(s)},e=n.red,r=n.green,u=n.blue,o=n.alpha,"rgba("+e+", "+r+", "+u+", "+(void 0===o?1:o)+")"}},m=a("hsl"),v=(p(["hue","saturation","lightness","alpha"]),u({},h,{test:a("#"),parse:function(t){var n="",e="",r="";return 4<t.length?(n=t.substr(1,2),e=t.substr(3,2),r=t.substr(5,2)):(n=t.substr(1,1),e=t.substr(2,1),r=t.substr(3,1),n+=n,e+=e,r+=r),{red:parseInt(n,16),green:parseInt(e,16),blue:parseInt(r,16),alpha:1}}}),0),y="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var n=Date.now(),e=Math.max(0,16.7-(n-v));v=n+e,setTimeout(function(){return t(v)},e)};(r=e||(e={})).Read="read",r.Update="update",r.Render="render",r.PostRender="postRender",r.FixedUpdate="fixedUpdate";var g,b=1/60*1e3,x=!0,O=!1,w=!1,M={delta:0,timestamp:0},j=[e.Read,e.Update,e.Render,e.PostRender],F=function(t){return O=t},P=j.reduce(function(t,n){var r,o,a,i,f,u,s,c,p,d=(r=F,o=[],f=!(a=[]),u=i=0,s=new WeakSet,c=new WeakSet,p={cancel:function(t){var n=a.indexOf(t);s.add(t),-1!==n&&a.splice(n,1)},process:function(t){var n,e;if(f=!0,o=(n=[a,o])[0],(a=n[1]).length=0,i=o.length)for(u=0;u<i;u++)(e=o[u])(t),!0!==c.has(e)||s.has(e)||(p.schedule(e),r(!0));f=!1},schedule:function(t,n,e){void 0===n&&(n=!1),void 0===e&&(e=!1);var r=e&&f,u=r?o:a;s.delete(t),n&&c.add(t),-1===u.indexOf(t)&&(u.push(t),r&&(i=o.length))}});return t.sync[n]=function(t,n,e){return void 0===n&&(n=!1),void 0===e&&(e=!1),O||W(),d.schedule(t,n,e),t},t.cancelSync[n]=function(t){return d.cancel(t)},t.steps[n]=d,t},{steps:{},sync:{},cancelSync:{}}),R=P.steps,S=P.sync,I=P.cancelSync,U=function(t){return R[t].process(M)},k=function(t){O=!1,M.delta=x?b:Math.max(Math.min(t-M.timestamp,40),1),x||(b=M.delta),M.timestamp=t,w=!0,j.forEach(U),w=!1,O&&(x=!1,y(k))},W=function(){x=O=!0,w||y(k)},q=function(){return M},A=(g=function(t,n,e){return Math.min(Math.max(e,t),n)},function(n,e,t){return void 0!==t?g(n,e,t):function(t){return g(n,e,t)}}),_=function(n,e){return function(t){return e(n(t))}},B=(A(0,1),function(t){throw t}),D=function(){return(D=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var u in n=arguments[e])Object.prototype.hasOwnProperty.call(n,u)&&(t[u]=n[u]);return t}).apply(this,arguments)};t.stream=function(a,i){var r=function(u,o){return{start:function(t){var n,e="function"==typeof(n=t)?{update:n}:n;if(o){var r=e.update;e.update=function(t){return r(o(t))}}return function(t,e,n,r){var u,o=0,a=D({},n,e),i={},f=Object.keys(e).filter(function(t){return void 0!==(n=e[t])&&n.hasOwnProperty("start");var n}),s=f.length;if(s)for(var c=function(t){var n=f[t];i[n]=e[n].start(function(t){return a[n]=t})},p=0;p<s;p++)c(p);var d,l="function"==typeof(d=t({error:B,complete:function(){return v()},initialProps:D({},a)}))?{update:d}:d,h=function(t){return t.timestamp!==o&&(u=l.update(a,t)),o=t.timestamp,u},m=function(t){h(t),r.update&&r.update(u)};m(q()),S.update(m,!0);var v=function(){for(var t in I.update(m),i)i[t].stop();r.complete&&r.complete(u),l.complete&&l.complete()};return{stop:v,pull:function(){return h(q())}}}(a,u,i,e)},pipe:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.reduce(_)}.apply(void 0,[o].concat(t).filter(Boolean));return r(u,e)}}};return r},Object.defineProperty(t,"__esModule",{value:!0})});
