!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).affluent={})}(this,function(t){"use strict";var n,e,r,o=function(){return(o=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},u=function(n,e){return function(t){return Math.max(Math.min(t,e),n)}},a=function(n){return function(t){return"string"==typeof t&&0===t.indexOf(n)}},s=function(t){return t%1?Number(t.toFixed(5)):t},i={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},f=(o({},i,{transform:u(0,1)}),o({},i,{default:1}),n="%",{test:function(t){return"string"==typeof t&&t.endsWith(n)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+n}}),c=u(0,255),p=function(a){var i=a.length;return function(t){if("string"!=typeof t)return t;for(var n,e,r={},o="string"==typeof(n=(e=t).substring(e.indexOf("(")+1,e.lastIndexOf(")")))?n.split(/,\s*/):[n],u=0;u<i;u++)r[a[u]]=void 0!==o[u]?parseFloat(o[u]):1;return r}},d=o({},i,{transform:function(t){return Math.round(c(t))}}),l=a("rgb"),h={test:function(t){return"string"==typeof t?l(t):void 0!==t.red},parse:p(["red","green","blue","alpha"]),transform:function(t){var n,e,r,o,u,a=t.red,i=t.green,f=t.blue,c=t.alpha;return n={red:d.transform(a),green:d.transform(i),blue:d.transform(f),alpha:s(c)},e=n.red,r=n.green,o=n.blue,u=n.alpha,"rgba("+e+", "+r+", "+o+", "+(void 0===u?1:u)+")"}},m=a("hsl"),v=(p(["hue","saturation","lightness","alpha"]),o({},h,{test:a("#"),parse:function(t){var n="",e="",r="";return 4<t.length?(n=t.substr(1,2),e=t.substr(3,2),r=t.substr(5,2)):(n=t.substr(1,1),e=t.substr(2,1),r=t.substr(3,1),n+=n,e+=e,r+=r),{red:parseInt(n,16),green:parseInt(e,16),blue:parseInt(r,16),alpha:1}}}),0),g="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var n=Date.now(),e=Math.max(0,16.7-(n-v));v=n+e,setTimeout(function(){return t(v)},e)};(r=e||(e={})).Read="read",r.Update="update",r.Render="render",r.PostRender="postRender",r.FixedUpdate="fixedUpdate";var y,b=1/60*1e3,x=!0,O=!1,w=!1,P={delta:0,timestamp:0},M=[e.Read,e.Update,e.Render,e.PostRender],j=function(t){return O=t},F=M.reduce(function(t,n){var r,u,a,i,f,o,c,s,p,d=(r=j,u=[],f=!(a=[]),o=i=0,c=new WeakSet,s=new WeakSet,p={cancel:function(t){var n=a.indexOf(t);c.add(t),-1!==n&&a.splice(n,1)},process:function(t){var n,e;if(f=!0,u=(n=[a,u])[0],(a=n[1]).length=0,i=u.length)for(o=0;o<i;o++)(e=u[o])(t),!0!==s.has(e)||c.has(e)||(p.schedule(e),r(!0));f=!1},schedule:function(t,n,e){void 0===n&&(n=!1),void 0===e&&(e=!1);var r=e&&f,o=r?u:a;c.delete(t),n&&s.add(t),-1===o.indexOf(t)&&(o.push(t),r&&(i=u.length))}});return t.sync[n]=function(t,n,e){return void 0===n&&(n=!1),void 0===e&&(e=!1),O||W(),d.schedule(t,n,e),t},t.cancelSync[n]=function(t){return d.cancel(t)},t.steps[n]=d,t},{steps:{},sync:{},cancelSync:{}}),R=F.steps,k=F.sync,S=F.cancelSync,I=function(t){return R[t].process(P)},U=function(t){O=!1,P.delta=x?b:Math.max(Math.min(t-P.timestamp,40),1),x||(b=P.delta),P.timestamp=t,w=!0,M.forEach(I),w=!1,O&&(x=!1,g(U))},W=function(){x=O=!0,w||g(U)},q=function(){return P},A=(y=function(t,n,e){return Math.min(Math.max(e,t),n)},function(n,e,t){return void 0!==t?y(n,e,t):function(t){return y(n,e,t)}}),E=function(n,e){return function(t){return e(n(t))}},_=(A(0,1),function(t){throw t}),B=function(){return(B=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},D=function(t){var e,r=!1,o=0,u="function"==typeof t?t:t.update;return{update:function(t,n){return r||n.timestamp===o||(o=n.timestamp,e=u(t,n)),e},complete:function(){r=!0,"function"!=typeof t&&t.complete&&t.complete()}}},N=function(r,o,t,n){var e=function(){return D(r({error:_,complete:o,initialProps:t}))};if(!n)return e();var u=[],a=0,i=n({create:function(t){var n,e=D(r({error:_,complete:(n=u.length,function(){a++,u[n].complete(),a>=u.length&&o()}),initialProps:t}));return u.push(e),e},initialProps:t});return i?B({},D(i),{complete:function(){return u.forEach(function(t){return t.complete()})}}):e()};t.stream=function(a,i,f){var r=function(o,u){return{start:function(t){var n,e="function"==typeof(n=t)?{update:n}:n;if(u){var r=e.update;e.update=function(t){return r(u(t))}}return function(t){var n=t.create,e=t.props,r=t.defaultProps,o=t.subscription,u=t.fork,a=B({},r,e),i={},f=Object.keys(e).filter(function(t){return void 0!==(n=e[t])&&n.hasOwnProperty("start");var n}),c=f.length;if(c)for(var s=function(t){var n=f[t];i[n]=e[n].start(function(t){a[n]=t})},p=0;p<c;p++)s(p);var d=N(n,function(){return m()},B({},a),u),l=function(t){return d.update(a,t)},h=function(t){o.update&&o.update(l(t))};h(q()),k.update(h,!0);var m=function(){for(var t in S.update(h),i)i[t].stop();o.complete&&o.complete(),d.complete()};return{stop:m,pull:function(){return l(q())}}}({create:a,props:o||{},defaultProps:i,subscription:e,fork:f})},pipe:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.reduce(E)}.apply(void 0,[u].concat(t).filter(Boolean));return r(o,e)}}};return r},Object.defineProperty(t,"__esModule",{value:!0})});
