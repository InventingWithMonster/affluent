!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).affluent={})}(this,function(e){"use strict";var t,n,w=function(){return(w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=0,o="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),n=Math.max(0,16.7-(t-r));r=t+n,setTimeout(function(){return e(r)},n)};(n=t||(t={})).Read="read",n.Update="update",n.Render="render",n.PostRender="postRender",n.FixedUpdate="fixedUpdate";var i=1/60*1e3,u=!0,l=!1,a=!1,c={delta:0,timestamp:0},f=[t.Read,t.Update,t.Render,t.PostRender],m=function(e){return l=e},d=f.reduce(function(e,t){var r,i,u,a,c,o,f,d,s,p=(r=m,i=[],c=!(u=[]),o=a=0,f=new WeakSet,d=new WeakSet,s={cancel:function(e){var t=u.indexOf(e);f.add(e),-1!==t&&u.splice(t,1)},process:function(e){var t,n;if(c=!0,i=(t=[u,i])[0],(u=t[1]).length=0,a=i.length)for(o=0;o<a;o++)(n=i[o])(e),!0!==d.has(n)||f.has(n)||(s.schedule(n),r(!0));c=!1},schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=n&&c,o=r?i:u;f.delete(e),t&&d.add(e),-1===o.indexOf(e)&&(o.push(e),r&&(a=i.length))}});return e.sync[t]=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),l||h(),p.schedule(e,t,n),e},e.cancelSync[t]=function(e){return p.cancel(e)},e.steps[t]=p,e},{steps:{},sync:{},cancelSync:{}}),s=d.steps,x=d.sync,O=d.cancelSync,p=function(e){return s[e].process(c)},v=function(e){l=!1,c.delta=u?i:Math.max(Math.min(e-c.timestamp,40),1),u||(i=c.delta),c.timestamp=e,a=!0,f.forEach(p),a=!1,l&&(u=!1,o(v))},h=function(){u=l=!0,a||o(v)},R=function(){return c},g=function(e){throw e};e.stream=function(n){return function(t){return void 0===t&&(t={}),{start:function(e){return function(e,n,t){var r,o,i=0,u=w({},n),a={},c="function"==typeof(o=t)?{update:o}:o,f=Object.keys(n).filter(function(e){return void 0!==(t=n[e])&&t.hasOwnProperty("start");var t}),d=f.length;if(d)for(var s=function(e){var t=f[e];a[t]=n[t].start(function(e){return u[t]=e})},p=0;p<d;p++)s(p);var l,m="function"==typeof(l=e({error:g,complete:function(){return y()},initial:w({},u)}))?{update:l}:l,v=function(e){return e.timestamp!==i&&(r=m.update(u,e)),i=e.timestamp,r},h=function(e){v(e),c.update&&c.update(r)};h(R()),x.update(h,!0);var y=function(){for(var e in O.update(h),a)a[e].stop();c.complete&&c.complete(r),m.complete&&m.complete()};return{stop:y,pull:function(){return v(R())}}}(n,t,e)}}}},Object.defineProperty(e,"__esModule",{value:!0})});
