!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).affluent={})}(this,function(e){"use strict";var n,t,m=function(){return(m=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},r=0,o="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var n=Date.now(),t=Math.max(0,16.7-(n-r));r=n+t,setTimeout(function(){return e(r)},t)};(t=n||(n={})).Read="read",t.Update="update",t.Render="render",t.PostRender="postRender",t.FixedUpdate="fixedUpdate";var i=1/60*1e3,u=!0,l=!1,a=!1,c={delta:0,timestamp:0},f=[n.Read,n.Update,n.Render,n.PostRender],v=function(e){return l=e},d=f.reduce(function(e,n){var r,i,u,a,c,o,f,d,s,p=(r=v,i=[],c=!(u=[]),o=a=0,f=new WeakSet,d=new WeakSet,s={cancel:function(e){var n=u.indexOf(e);f.add(e),-1!==n&&u.splice(n,1)},process:function(e){var n,t;if(c=!0,i=(n=[u,i])[0],(u=n[1]).length=0,a=i.length)for(o=0;o<a;o++)(t=i[o])(e),!0!==d.has(t)||f.has(t)||(s.schedule(t),r(!0));c=!1},schedule:function(e,n,t){void 0===n&&(n=!1),void 0===t&&(t=!1);var r=t&&c,o=r?i:u;f.delete(e),n&&d.add(e),-1===o.indexOf(e)&&(o.push(e),r&&(a=i.length))}});return e.sync[n]=function(e,n,t){return void 0===n&&(n=!1),void 0===t&&(t=!1),l||x(),p.schedule(e,n,t),e},e.cancelSync[n]=function(e){return p.cancel(e)},e.steps[n]=p,e},{steps:{},sync:{},cancelSync:{}}),s=d.steps,h=d.sync,y=d.cancelSync,p=function(e){return s[e].process(c)},w=function(e){l=!1,c.delta=u?i:Math.max(Math.min(e-c.timestamp,40),1),u||(i=c.delta),c.timestamp=e,a=!0,f.forEach(p),a=!1,l&&(u=!1,o(w))},x=function(){u=l=!0,a||o(w)},O=function(){return c},R=function(e){throw e};e.stream=function(t){return function(n){return{start:function(e){return function(e,t,n){var r,o=0,i=m({},t),u={},a=Object.keys(t).filter(function(e){return void 0!==(n=t[e])&&n.hasOwnProperty("start");var n}),c=a.length;if(c)for(var f=function(e){var n=a[e];u[n]=t[n].start(function(e){return i[n]=e})},d=0;d<c;d++)f(d);var s=e({error:R,complete:function(){return v},initial:m({},i)}),p=function(e){return e.timestamp!==o&&(r=s(i,e)),o=e.timestamp,r},l=function(e){n(p(e))};l(O()),h.update(l,!0);var v=function(){for(var e in y.update(l),u)u[e].stop()};return{stop:v,pull:function(){return p(O())}}}(t,n,e)}}}},Object.defineProperty(e,"__esModule",{value:!0})});
